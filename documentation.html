<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Galerie</title>
    <link rel="stylesheet" href="./css/style-galerie.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
  </head>
  <body>
    <header>
      <nav>
        <ul>
          <li><a href="./actualite.html">Actualités</a></li>
          <li><a href="./biodiversite.htm">Biodiversité</a></li>
          <a href="./index.html"
            ><div class="logo"><img src="./assets/logo.png" alt="" /></div
          ></a>
          <li><a href="./galerie.html">Galerie</a></li>
          <li><a href="./documentation.html">Documentations</a></li>
        </ul>
      </nav>
    </header>
    <section class="hero-banner">
      <img id="hero-photo" src="./assets/img-29.jpg" alt="" />
      <h1>Carte</h1>
      <div class="scroll-arrow">⬇</div>
    </section>
    <section>
      <div id="viewerDiv" style="width: 100%; height: 600px"></div>
    </section>

    <footer>
      <div class="img-logo">
        <nav>
          <ul>
            <li><a href="./actualite.html">Actualités</a></li>
            <li><a href="./biodiversite.htm">Biodiversité</a></li>
            <li><a href="./galerie.html">Galerie</a></li>
            <li><a href="./documentation.html">Documentations</a></li>
          </ul>
        </nav>
        <a href="./index.html"
          ><img style="width: 190px" src="./assets/logo.png" alt=""
        /></a>
      </div>
      <hr />
      <div class="partners">
        <img src="./assets/logo-ue-occ.jpg" alt="" />
        <img src="./assets/logo-occ.png" alt="" />
        <img src="./assets/logo-natura.jpg" alt="" />
      </div>
    </footer>

    <script>
      window.addEventListener("scroll", function () {
        const header = document.querySelector("header");
        const nav = document.querySelector("nav");
        const scrollArrow = document.querySelector(".scroll-arrow");
        if (window.scrollY > 250) {
          header.classList.add("scroll-active");
          nav.classList.add("scroll-active-nav");
          scrollArrow.classList.add("hidden");
        } else {
          header.classList.remove("scroll-active");
          scrollArrow.classList.remove("hidden");
        }
      });
      var map = {
        map: "",
        idMap: "viewerDiv",
        zoom: 14,
        longitude: 3.2784,
        latitude: 43.2722,

        setLongitude: function (longitude) {
          this.longitude = longitude;
        },
        setLatitude: function (latitude) {
          this.latitude = latitude;
        },

        init: function (longitude, latitude) {
          this.setLongitude(longitude);
          this.setLatitude(latitude);

          this.map = L.map(this.idMap).setView(
            [this.latitude, this.longitude],
            this.zoom
          );

          let orthoLayer = this.createLayer(
            "decouverte",
            "image/jpeg",
            "ORTHOIMAGERY.ORTHOPHOTOS",
            1,
            "IGN-F/Géoportail"
          );

          let osmLayer = L.tileLayer(
            "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            {
              attribution: "&copy; OpenStreetMap contributors",
            }
          );

          L.control
            .layers({ "Satellite IGN": orthoLayer, OSM: osmLayer })
            .addTo(this.map);

          orthoLayer.addTo(this.map);
        },

        createLayer: function (
          key,
          format,
          layerName,
          opacity,
          attribution,
          style = "normal"
        ) {
          let newLayer = L.tileLayer(
            "https://data.geopf.fr/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={layer}&STYLE={style}&FORMAT={format}&TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",
            {
              key: key,
              format: format,
              layer: layerName,
              opacity: opacity,
              attribution: attribution,
              style: style,
              minZoom: 0,
              maxZoom: 16,
              tileSize: 256,
            }
          );
          return newLayer;
        },
      };

      // S'assure que la carte est initialisée avant de charger le GeoJSON
      document.addEventListener("DOMContentLoaded", function () {
        map.init(3.2784, 43.2722);
        loadGeoJSON(); // Charge le GeoJSON après que la carte soit prête
      });

      function loadGeoJSON() {
        fetch("./map.geojson") // Charge le fichier GeoJSON
          .then((response) => response.json())
          .then((data) => {
            let geojsonLayer = L.geoJSON(data, {
              style: function (feature) {
                return {
                  color: feature.properties.stroke, // Contour
                  weight: feature.properties["stroke-width"], // Épaisseur contour
                  fillColor: feature.properties.fill, // Couleur de remplissage
                  fillOpacity: feature.properties["fill-opacity"], // Opacité remplissage
                };
              },
              onEachFeature: function (feature, layer) {
                if (feature.properties && feature.properties.nom) {
                  layer.bindPopup(feature.properties.nom); // Ajoute une popup avec le nom
                }
              },
            }).addTo(map.map); // Ajoute le GeoJSON à la carte

            // Ajuste la vue pour englober la zone
            map.map.options.minZoom = 14;
            map.map.fitBounds(geojsonLayer.getBounds());
          })
          .catch((error) =>
            console.error("Erreur de chargement du GeoJSON:", error)
          );
      }
    </script>
  </body>
</html>
